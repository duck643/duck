<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>–£—Ç–∏–Ω—ã–π –û—Å—Ç—Ä–æ–≤</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #0F1A2C;
      color: #E0F7FA;
      font-family: 'Segoe UI', sans-serif;
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 16px;
    }

    #ui {
      z-index: 10;
      text-align: center;
      margin-bottom: 12px;
    }

    #score {
      font-size: 20px;
      text-shadow: 0 0 6px rgba(125, 206, 160, 0.6);
    }

    #feathers {
      font-size: 18px;
      margin-top: 4px;
      text-shadow: 0 0 6px rgba(255, 100, 100, 0.6);
    }

    #pond {
      width: 95vw;
      height: 70vh;
      position: relative;
      overflow: hidden;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .water {
      width: 100%;
      height: 100%;
      background: url('newlake.png') no-repeat center center;
      background-size: cover;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    .duck {
      position: absolute;
      width: 60px;
      height: 70px;
      background: url('duck_normal.png') no-repeat center;
      background-size: contain;
      cursor: pointer;
      z-index: 5;
    }

    .btn {
      background: transparent;
      border: 2px solid #7DCEA0;
      color: #E0F7FA;
      padding: 6px 12px;
      margin: 4px 4px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }

    .btn:hover {
      background: rgba(125, 206, 160, 0.15);
    }

    #duckCount {
      position: absolute;
      top: 16px;
      right: 16px;
      background: rgba(0, 0, 0, 0.5);
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 18px;
      text-shadow: 0 0 4px rgba(255, 255, 255, 0.8);
      z-index: 20;
    }

    .quack-bubble {
      position: absolute;
      background: rgba(255, 255, 255, 0.9);
      color: #0F1A2C;
      padding: 6px 12px;
      border-radius: 10px;
      font-weight: bold;
      font-size: 14px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      z-index: 100;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–∫–Ω–∞ –∫–≤–µ—Å—Ç–∞ */
    #questModal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
    }

    .modal-content {
      background-color: #1a2d3f;
      color: #E0F7FA;
      border: 2px solid #7DCEA0;
      border-radius: 12px;
      margin: 15% auto;
      padding: 20px;
      width: 80%;
      max-width: 600px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .close {
      color: #E0F7FA;
      float: right;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover,
    .close:focus {
      color: #7DCEA0;
      text-decoration: none;
      cursor: pointer;
    }

    #questJournalContent {
      margin-top: 20px;
      line-height: 1.6;
    }

    .quest-task {
      background: #2c3e50;
      color: #E0F7FA;
      padding: 12px;
      margin: 10px 0;
      border-left: 4px solid #7DCEA0;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .quest-task:hover {
      background: #34495e;
      transform: translateX(5px);
      border-left-color: #E0F7FA;
    }

    .quest-done {
      background: #27ae60;
      text-decoration: line-through;
      color: #bdc3c7;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫—Ä–æ–≤–∞–≤–æ–≥–æ –ø–µ—Ä–∞ */
    .bloody-feather {
      position: absolute;
      width: 30px;
      height: 40px;
      background: url('bloody_feather.png') no-repeat center;
      background-size: contain;
      z-index: 6;
      animation: float 3s ease-in-out infinite;
      filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.5));
      cursor: pointer;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-10px) rotate(5deg); }
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —É—Ç–∫–∏-–ø–æ—á—Ç–∞–ª—å–æ–Ω–∞ */
    .postman-duck {
      background: url('postman_duck.png') no-repeat center;
      background-size: contain;
      width: 70px;
      height: 80px;
    }

    /* –ö–Ω–æ–ø–∫–∞ –∂—É—Ä–Ω–∞–ª–∞ –∫–≤–µ—Å—Ç–æ–≤ */
    #questJournal {
      position: absolute;
      top: 16px;
      left: 16px;
      background: rgba(0, 0, 0, 0.5);
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
      z-index: 20;
      border: 1px solid #7DCEA0;
    }

    #questJournal:hover {
      background: rgba(125, 206, 160, 0.2);
    }

    /* === –°–ò–°–¢–ï–ú–ê –î–ò–ê–õ–û–ì–û–í === */

    .dialog-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }

    .dialog-content {
      background: #1a2d3f;
      border: 2px solid #7DCEA0;
      border-radius: 12px;
      padding: 20px;
      max-width: 90%;
      max-height: 80%;
      overflow-y: auto;
      color: #E0F7FA;
      box-shadow: 0 0 20px rgba(125, 206, 160, 0.3);
    }

    .dialog-content h3 {
      color: #7DCEA0;
      margin-bottom: 15px;
      text-align: center;
      font-size: 18px;
    }

    .dialog-message {
      margin: 15px 0;
      line-height: 1.5;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 8px;
      border-left: 3px solid #7DCEA0;
    }

    .dialog-choices {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 20px;
    }

    .dialog-choice {
      background: #2c3e50;
      border: 1px solid #7DCEA0;
      color: #E0F7FA;
      padding: 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
      font-size: 14px;
    }

    .dialog-choice:hover {
      background: #34495e;
      transform: translateX(5px);
      border-color: #E0F7FA;
    }

    .dialog-choice:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    .requirement-not-met {
      opacity: 0.7;
      position: relative;
    }

    .requirement-not-met::after {
      content: "‚ùå –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ";
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 10px;
      color: #ff6b6b;
    }

    /* –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ */
    .notification {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.85);
      color: #ff6b6b;
      padding: 12px 24px;
      border-radius: 8px;
      z-index: 20000;
      font-size: 16px;
      pointer-events: none;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <div id="ui">
    <div id="score">–ó–µ—Ä–Ω—ã—à–µ–∫: 0</div>
    <div id="feathers">–ü–µ—Ä—å–µ–≤: 0</div>
    <button class="btn" id="buyNormal">–£—Ç–∫–∞ (20)</button>
    <button class="btn" id="buyHat">–£—Ç–∫–∞ –≤ —à–ª—è–ø–µ (50)</button>
    <button class="btn" id="buySunglasses">–£—Ç–∫–∞ –≤ –æ—á–∫–∞—Ö (100)</button>
    <button class="btn" id="exchangeFeather">–û–±–º–µ–Ω—è—Ç—å (150)</button>
  </div>
  <div id="duckCount">–£—Ç–æ–∫: 0</div>
  <div id="questJournal">üìÅ</div>
  <div id="pond">
    <div class="water"></div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ö–≤–µ—Å—Ç–∞ -->
  <div id="questModal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>–î–æ—Å—å–µ: –¢–µ–Ω–∏ –ó–∞–±–≤–µ–Ω–∏—è –Ω–∞ –£—Ç–∏–Ω–æ–º –û–∑–µ—Ä–µ</h2>
      <div id="questJournalContent">
        <div class="quest-task">–ù–∞–π–¥–∏ –∫—Ä–æ–≤–∞–≤–æ–µ –ø–µ—Ä–æ</div>
        <div class="quest-task">–ü–æ–≥–æ–≤–æ—Ä–∏ —Å —É—Ç–∫–æ–π-–ø–æ—á—Ç–∞–ª—å–æ–Ω–æ–º</div>
        <div class="quest-task">–°–æ–±–µ—Ä–∏ 5 –ø–µ—Ä—å–µ–≤</div>
      </div>
    </div>
  </div>

  <script>
    // --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ---
    let score = 0;
    let feathers = 0;
    let duckCount = 0;
    let bloodyFeatherAdded = false;
    let postmanAdded = false;

    // --- DOM —ç–ª–µ–º–µ–Ω—Ç—ã ---
    const scoreEl = document.getElementById('score');
    const feathersEl = document.getElementById('feathers');
    const duckCountEl = document.getElementById('duckCount');
    const pond = document.getElementById('pond');
    const questModal = document.getElementById('questModal');
    const questJournalBtn = document.getElementById('questJournal');
    const closeModal = document.querySelector('.close');

    // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---
    function updateUI() {
      scoreEl.textContent = `–ó–µ—Ä–Ω—ã—à–µ–∫: ${score}`;
      feathersEl.textContent = `–ü–µ—Ä—å–µ–≤: ${feathers}`;
      duckCountEl.textContent = `–£—Ç–æ–∫: ${duckCount}`;
    }

    function showNotification(text) {
      const notif = document.createElement('div');
      notif.className = 'notification';
      notif.textContent = text;
      document.body.appendChild(notif);
      setTimeout(() => {
        notif.remove();
      }, 2000);
    }

    function getRandomPosition() {
      const x = Math.random() * (pond.clientWidth - 60);
      const y = Math.random() * (pond.clientHeight - 70);
      return { x, y };
    }

    function addDuck(type = 'normal') {
      const duck = document.createElement('div');
      duck.className = 'duck npc';
      if (type === 'hat') {
        duck.style.backgroundImage = "url('duck_hat.png')";
      } else if (type === 'sunglasses') {
        duck.style.backgroundImage = "url('duck_sunglasses.png')";
      } else {
        duck.style.backgroundImage = "url('duck_normal.png')";
      }
      const pos = getRandomPosition();
      duck.style.left = `${pos.x}px`;
      duck.style.top = `${pos.y}px`;
      pond.appendChild(duck);
    }

    function addBloodyFeather() {
      const feather = document.createElement('div');
      feather.className = 'bloody-feather';
      const pos = getRandomPosition();
      feather.style.left = `${pos.x}px`;
      feather.style.top = `${pos.y}px`;
      feather.addEventListener('click', () => {
        feathers++;
        updateUI();
        feather.remove();
        showNotification('+1 –∫—Ä–æ–≤–∞–≤–æ–µ –ø–µ—Ä–æ!');
      });
      pond.appendChild(feather);
    }

    function addPostmanDuck() {
      if (postmanAdded) return;
      const postman = document.createElement('div');
      postman.className = 'duck npc postman-duck';
      postman.style.left = '20%';
      postman.style.top = '60%';
      postman.addEventListener('click', startQuestDialog);
      pond.appendChild(postman);
      postmanAdded = true;
    }

    function startQuestDialog() {
      const overlay = document.createElement('div');
      overlay.className = 'dialog-overlay';
      overlay.innerHTML = `
        <div class="dialog-content">
          <h3>–£—Ç–∫–∞-–ü–æ—á—Ç–∞–ª—å–æ–Ω</h3>
          <div class="dialog-message">
            –ö—Ä—è-–∫—Ä—è! –Ø –ø—Ä–∏–Ω—ë—Å —Ç–µ–±–µ –≤–∞–∂–Ω–æ–µ –ø–∏—Å—å–º–æ... –Ω–æ –æ–Ω–æ –∑–∞–ø–µ—á–∞—Ç–∞–Ω–æ –∫—Ä–æ–≤–∞–≤—ã–º –ø–µ—Ä–æ–º. 
            –ß—Ç–æ–±—ã –µ–≥–æ –æ—Ç–∫—Ä—ã—Ç—å, —Ç–µ–±–µ –Ω—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å <strong>5 –∫—Ä–æ–≤–∞–≤—ã—Ö –ø–µ—Ä—å–µ–≤</strong>.
          </div>
          <div class="dialog-choices">
            <div class="dialog-choice" onclick="closeDialog()">¬´–°–ø–∞—Å–∏–±–æ, —è –ø–æ–∏—â—É –ø–µ—Ä—å—è¬ª</div>
            <div class="${feathers >= 5 ? 'dialog-choice' : 'dialog-choice requirement-not-met'}" 
                 onclick="checkFeathers()">
              ¬´–£ –º–µ–Ω—è —É–∂–µ –µ—Å—Ç—å 5 –ø–µ—Ä—å–µ–≤!¬ª
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(overlay);
    }

    function closeDialog() {
      const overlay = document.querySelector('.dialog-overlay');
      if (overlay) overlay.remove();
    }

    function checkFeathers() {
      if (feathers >= 5) {
        closeDialog();
        showNotification('–ü–∏—Å—å–º–æ –æ—Ç–∫—Ä—ã—Ç–æ! –ù–æ–≤–∞—è –≥–ª–∞–≤–∞...');
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç—Ç–∞–ø–∞ –∫–≤–µ—Å—Ç–∞
      } else {
        showNotification('–ù—É–∂–Ω–æ 5 –ø–µ—Ä—å–µ–≤!');
      }
    }

    // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ ---
    document.getElementById('buyNormal').addEventListener('click', () => {
      if (score >= 20) {
        score -= 20;
        duckCount++;
        addDuck('normal');
        updateUI();
      } else {
        showNotification('–ù—É–∂–Ω–æ 20 –∑–µ—Ä–Ω—ã—à–µ–∫!');
      }
    });

    document.getElementById('buyHat').addEventListener('click', () => {
      if (score >= 50) {
        score -= 50;
        duckCount++;
        addDuck('hat');
        updateUI();
      } else {
        showNotification('–ù—É–∂–Ω–æ 50 –∑–µ—Ä–Ω—ã—à–µ–∫!');
      }
    });

    document.getElementById('buySunglasses').addEventListener('click', () => {
      if (score >= 100) {
        score -= 100;
        duckCount++;
        addDuck('sunglasses');
        updateUI();

        // –î–æ–±–∞–≤–ª—è–µ–º –∫—Ä–æ–≤–∞–≤–æ–µ –ø–µ—Ä–æ –¢–û–õ–¨–ö–û –û–î–ò–ù –†–ê–ó
        if (!bloodyFeatherAdded) {
          setTimeout(() => {
            addBloodyFeather();
            bloodyFeatherAdded = true;
            // –ü–æ—Å–ª–µ –ø–µ—Ä–∞ ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ—á—Ç–∞–ª—å–æ–Ω–∞
            setTimeout(addPostmanDuck, 1000);
          }, 500);
        }
      } else {
        showNotification('–ù—É–∂–Ω–æ 100 –∑–µ—Ä–Ω—ã—à–µ–∫ –¥–ª—è —É—Ç–∫–∏ –≤ –æ—á–∫–∞—Ö!');
      }
    });

    document.getElementById('exchangeFeather').addEventListener('click', () => {
      if (score >= 150) {
        score -= 150;
        feathers += 1;
        updateUI();
        showNotification('+1 –ø–µ—Ä–æ –∑–∞ –æ–±–º–µ–Ω!');
      } else {
        showNotification('–ù—É–∂–Ω–æ 150 –∑–µ—Ä–Ω—ã—à–µ–∫ –¥–ª—è –æ–±–º–µ–Ω–∞!');
      }
    });

    // --- –ö–ª–∏–∫ –ø–æ –ø—Ä—É–¥—É ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–µ—Ä–Ω—ã—à–µ–∫ ---
    pond.addEventListener('click', (e) => {
      if (!e.target.classList.contains('duck') && !e.target.classList.contains('bloody-feather')) {
        score++;
        updateUI();
      }
    });

    // --- –ñ—É—Ä–Ω–∞–ª –∫–≤–µ—Å—Ç–æ–≤ ---
    questJournalBtn.addEventListener('click', () => {
      questModal.style.display = 'block';
    });

    closeModal.addEventListener('click', () => {
      questModal.style.display = 'none';
    });

    window.addEventListener('click', (e) => {
      if (e.target === questModal) {
        questModal.style.display = 'none';
      }
    });

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
    updateUI();

    // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è inline-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–≤ –¥–∏–∞–ª–æ–≥–µ)
    window.closeDialog = closeDialog;
    window.checkFeathers = checkFeathers;
  </script>
</body>
</html>
